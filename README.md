# marketplace-api-checker

Расширение для **1С:Предприятие 8.3** (управляемое приложение), которое добавляет сценарий интеллектуального глобального поиска и отправку текстовых запросов в внешний сервис НОПи для мониторинга API маркетплейсов.

## Что делает проект

- Перехватывает событие глобального поиска и открывает собственную форму поиска по триггеру в строке поиска.
- Выполняет полнотекстовый поиск по данным ИБ с постраничной навигацией и подсветкой найденных фрагментов.
- Обрабатывает специальную команду вида `нопик, ...` и отправляет текст запроса в сервис НОПи по HTTP.
- Сохраняет историю взаимодействий с сервисом в регистр сведений `НОП_ИсторияВзаимодействияНопик`.

## Ключевые сценарии

### 1) Запуск формы расширенного поиска

В стандартном поле глобального поиска 1С введите строку, начинающуюся с:

- `. .`
- `/ /`

После этого стандартный план поиска очищается, и открывается форма `НОП_ФормаПоиска`.

### 2) Поиск по объектам ИБ

В форме:

- вводится поисковая строка;
- выполняется полнотекстовый поиск порциями по 10 записей;
- поддерживается переход к найденному объекту;
- хранится локальная история последних поисков (до 10 значений).

### 3) Отправка запроса в НОПи

Если в форме строка поиска начинается с `нопик,` (регистр первой буквы допускается), выполняется:

1. Вычисление MD5-хеша текста (токен учета).
2. Формирование XML-запроса.
3. Отправка на HTTP-адрес сервиса.
4. Сохранение результата в регистр истории.

При успешной отправке пользователю показывается время регистрации обращения на стороне НОПи.

## Настройка

### Адрес сервиса

Используется константа:

- `НОП_АдресСервисаНОПи`

Если константа не заполнена, модуль устанавливает значение по умолчанию:

- `http://nopi.pro:20354/message`

Рекомендуется явно задать адрес вашего сервиса НОПи в константе перед эксплуатацией.

## Хранимые данные

Регистр сведений `НОП_ИсторияВзаимодействияНопик` хранит:

- локальное время отправки;
- время на сервере НОПи (заголовок `Date`);
- текст обращения;
- токен;
- GUID запроса.

## Состав расширения

- Управляемое приложение: перехват `ПриГлобальномПоиске`.
- Общая форма: `НОП_ФормаПоиска`.
- Общие модули:
	- `НОП_ГлобальныйПоискКлиент`
	- `НОП_ГлобальныйПоискКлиентСервер`
	- `НОП_ГлобальныйПоискВызовСервера`
	- `НОП_ГлобальныйПоискСервер`
	- `НОП_ОтправитьЗаданиеНопиСервер`
- Константа: `НОП_АдресСервисаНОПи`.
- Регистр сведений: `НОП_ИсторияВзаимодействияНопик`.

## Установка и запуск

Репозиторий содержит исходники расширения в формате выгрузки метаданных 1С (XML + BSL).

Типовой порядок подключения:

1. Загрузить расширение в конфигурацию (через Конфигуратор/EDT).
2. Убедиться, что расширение активно в нужной ИБ.
3. Проверить значение `НОП_АдресСервисаНОПи`.
4. Запустить тонкий/веб-клиент, открыть глобальный поиск и протестировать сценарии:
	 - `. .` или `/ /` для открытия формы;
	 - `нопик, тест` для отправки обращения.

## Совместимость

- Платформа: режим совместимости расширения `8.3.16`.
- Режим запуска: `ManagedApplication`.
- Язык скрипта: русский.

## Лицензия

Проект распространяется по лицензии MIT. См. файл `LICENSE`.